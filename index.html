<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vision Board</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: white;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* HEADER */
header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: #7FA1BE;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

button, select {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: white;
  cursor: pointer;
  font-weight: bold;
}
button:hover, select:hover { background: #7FAFDA; }

#vision-board {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-auto-rows: 100px;
  gap: 0;
  width: 95%;
  max-width: 600px;
  margin-top: 20px;
}

/* CELLE */
.cell {
  position: relative;
  border: 0.8px solid #ddd;
  background: #fafafa;
  overflow: hidden;
  cursor: pointer;
}
.cell img { width: 100%; height: 100%; object-fit: cover; }

.add-image-text {
  position: absolute;
  bottom: 5px;
  right: 5px;
  font-size: 10px;
  color: #C0C0C0;
  pointer-events: none;
}

/* TEXT */
.draggable-text {
  position: absolute;
  background: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: bold;
  cursor: grab;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}
.draggable-text.editing {
  outline: 2px dashed #444;
}
</style>
</head>

<body>

<header>
  <h1 style="color:white;margin:0;">
    Vision Board
    <select id="yearSelect">
      <option>2025</option>
      <option>2026</option>
      <option>2027</option>
    </select>
  </h1>

  <div>
    <button id="saveBtn">Save PNG</button>
    <button id="localSaveBtn">Local Save</button>
    <button id="clearBtn">Clear</button>
    <button id="textBtn">Add Text</button>
  </div>
</header>

<!-- POPUP TEXT -->
<div id="textPopup" style="display:none; position:fixed; top:80px; right:20px; background:white; border:1px solid #ccc; padding:15px; box-shadow:0 2px 8px rgba(0,0,0,0.3); z-index:100;">
  <textarea id="customText" style="width:200px;height:60px;margin-bottom:10px;" placeholder="Enter text"></textarea>

  <select id="fontSelect" style="width:100%;margin-bottom:10px;">
    <option>Arial</option>
    <option>Georgia</option>
    <option>Courier New</option>
    <option>Comic Sans MS</option>
    <option>Times New Roman</option>
  </select>

  <select id="fontSize" style="width:100%;margin-bottom:10px;">
    <option value="14">Small</option>
    <option value="18" selected>Medium</option>
    <option value="24">Large</option>
    <option value="32">Extra Large</option>
  </select>

  <button id="addTextToBoard" style="width:100%;">Add</button>
</div>

<div id="vision-board"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>

const board = document.getElementById("vision-board");
const yearSelect = document.getElementById("yearSelect");

const totalCells = 12;

/* -----------------------
   CREATE BOARD & CELLS
----------------------- */
function createEmptyBoard() {
  board.innerHTML = "";
  for (let i = 0; i < totalCells; i++) createCell();
}

function createCell() {
  const cell = document.createElement("div");
  cell.className = "cell";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.style.position = "absolute";
  checkbox.style.top = "5px";
  checkbox.style.left = "5px";
  cell.appendChild(checkbox);

  const label = document.createElement("div");
  label.className = "add-image-text";
  label.textContent = "Add Image";
  cell.appendChild(label);

  cell.addEventListener("click", (e) => {
    if (e.target === checkbox) return;

    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";

    input.onchange = () => {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        const oldLabel = cell.querySelector(".add-image-text");
        if (oldLabel) oldLabel.remove();

        let img = cell.querySelector("img");
        if (!img) img = cell.appendChild(document.createElement("img"));

        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    };

    input.click();
  });

  board.appendChild(cell);
}

/* -----------------------
   DRAG TEXT
----------------------- */
function makeDraggable(el) {
  let dragging = false, startX, startY, startLeft, startTop;

  el.addEventListener("mousedown", start);
  el.addEventListener("touchstart", start, { passive: false });

  function start(e) {
    if (e.target.isContentEditable) return;

    dragging = true;
    const rect = el.getBoundingClientRect();
    const boardRect = board.getBoundingClientRect();

    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;

    startX = cx;
    startY = cy;
    startLeft = rect.left - boardRect.left;
    startTop = rect.top - boardRect.top;

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", end);
    document.addEventListener("touchmove", move, { passive: false });
    document.addEventListener("touchend", end);
  }

  function move(e) {
    if (!dragging) return;
    e.preventDefault();

    const cx = e.touches ? e.touches[0].clientX : e.clientX;
    const cy = e.touches ? e.touches[0].clientY : e.clientY;

    el.style.left = startLeft + (cx - startX) + "px";
    el.style.top = startTop + (cy - startY) + "px";
  }

  function end() {
    dragging = false;
    document.removeEventListener("mousemove", move);
    document.removeEventListener("mouseup", end);
    document.removeEventListener("touchmove", move);
    document.removeEventListener("touchend", end);
  }
}

/* -----------------------
   TEXT EDITING
----------------------- */
function enableTextEditing(el) {
  el.addEventListener("dblclick", () => {
    el.contentEditable = true;
    el.classList.add("editing");
    el.focus();
  });

  el.addEventListener("blur", () => {
    el.contentEditable = false;
    el.classList.remove("editing");
  });

  el.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    if (confirm("Delete this text?")) el.remove();
  });
}

/* -----------------------
   RE-INIT AFTER LOAD
----------------------- */
function reinitializeBoard() {
  board.querySelectorAll(".cell").forEach(cell => {
    let checkbox = cell.querySelector("input[type=checkbox]");

    cell.addEventListener("click", (e) => {
      if (e.target === checkbox) return;

      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";

      input.onchange = () => {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const oldLabel = cell.querySelector(".add-image-text");
          if (oldLabel) oldLabel.remove();

          let img = cell.querySelector("img");
          if (!img) img = cell.appendChild(document.createElement("img"));
          img.src = reader.result;
        };
        reader.readAsDataURL(file);
      };

      input.click();
    });
  });

  board.querySelectorAll(".draggable-text").forEach(el => {
    makeDraggable(el);
    enableTextEditing(el);
  });
}

/* -----------------------
   LOAD YEAR DATA
----------------------- */
function loadYearBoard() {
  const year = yearSelect.value;
  const saved = localStorage.getItem("visionBoard_" + year);

  if (saved && saved.trim() !== "") {
    board.innerHTML = saved;
    reinitializeBoard();
  } else {
    createEmptyBoard();
  }
}

/* -----------------------
   EVENTS
----------------------- */

/* Add Text Button */
document.getElementById("textBtn").onclick = () => {
  const popup = document.getElementById("textPopup");
  popup.style.display = popup.style.display === "block" ? "none" : "block";
};

/* Add Text To Board */
document.getElementById("addTextToBoard").onclick = () => {
  const text = document.getElementById("customText").value.trim();
  if (!text) return;

  const el = document.createElement("div");
  el.className = "draggable-text";
  el.textContent = text;

  el.style.fontFamily = document.getElementById("fontSelect").value;
  el.style.fontSize = document.getElementById("fontSize").value + "px";
  el.style.left = "40px";
  el.style.top = "100px";

  board.appendChild(el);
  makeDraggable(el);
  enableTextEditing(el);
};

/* SAVE LOCAL */
document.getElementById("localSaveBtn").onclick = () => {
  const year = yearSelect.value;
  localStorage.setItem("visionBoard_" + year, board.innerHTML);
  alert("Saved for year " + year);
};

/* CLEAR */
document.getElementById("clearBtn").onclick = () => {
  if (confirm("Clear this year's board?")) {
    const year = yearSelect.value;
    localStorage.removeItem("visionBoard_" + year);
    createEmptyBoard();
  }
};

/* SAVE PNG */
document.getElementById("saveBtn").onclick = () => {
  html2canvas(board).then(canvas => {
    const link = document.createElement("a");
    link.download = "vision-board.png";
    link.href = canvas.toDataURL();
    link.click();
  });
};

/* CHANGE YEAR */
yearSelect.onchange = loadYearBoard;

/* FIRST LOAD */
loadYearBoard();

</script>
</body>
</html>
